<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <section id="login-section" class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 text-center">Admin Login</h2>
        <form id="login-form">
            <div class="mb-4">
                <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                <input type="email" id="email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div class="mb-6">
                <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Password:</label>
                <input type="password" id="password" name="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div class="flex items-center justify-between">
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Login
                </button>
            </div>
        </form>
    </section>

    <section id="admin-content" class="hidden bg-white p-8 rounded-lg shadow-md w-full max-w-4xl">
        <h2 class="text-2xl font-bold mb-6 text-center">Admin Dashboard</h2>
        <button id="logout-button" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mb-4">Logout</button>

        <h3 class="text-xl font-semibold mb-4">Add New Tool</h3>
        <form id="add-tool-form" class="mb-8">
            <div class="mb-4">
                <label for="tool-name" class="block text-gray-700 text-sm font-bold mb-2">Tool Name:</label>
                <input type="text" id="tool-name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div class="mb-4">
                <label for="tool-description" class="block text-gray-700 text-sm font-bold mb-2">Description:</label>
                <textarea id="tool-description" name="description" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3" required></textarea>
            </div>
            <div class="mb-4">
                <label for="tool-image" class="block text-gray-700 text-sm font-bold mb-2">Image URL:</label>
                <input type="url" id="tool-image" name="image" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div class="mb-4">
                <label for="tool-link" class="block text-gray-700 text-sm font-bold mb-2">Link:</label>
                <input type="url" id="tool-link" name="link" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Add Tool</button>
        </form>

        <h3 class="text-xl font-semibold mb-4">Existing Tools</h3>
        <div id="tools-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            </div>

        <h3 class="text-xl font-semibold mt-8 mb-4">Add New Feature</h3>
        <form id="add-feature-form" class="mb-8">
            <div class="mb-4">
                <label for="feature-name" class="block text-gray-700 text-sm font-bold mb-2">Feature Name:</label>
                <input type="text" id="feature-name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div class="mb-4">
                <label for="feature-description" class="block text-gray-700 text-sm font-bold mb-2">Description:</label>
                <textarea id="feature-description" name="description" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3" required></textarea>
            </div>
            <div class="mb-4">
                <label for="feature-image" class="block text-gray-700 text-sm font-bold mb-2">Image URL:</label>
                <input type="url" id="feature-image" name="image" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Add Feature</button>
        </form>

        <h3 class="text-xl font-semibold mb-4">Existing Features</h3>
        <div id="features-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            </div>

        <h3 class="text-xl font-semibold mt-8 mb-4">Add New FAQ</h3>
        <form id="add-faq-form" class="mb-8">
            <div class="mb-4">
                <label for="faq-question" class="block text-gray-700 text-sm font-bold mb-2">Question:</label>
                <input type="text" id="faq-question" name="question" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
            </div>
            <div class="mb-4">
                <label for="faq-answer" class="block text-gray-700 text-sm font-bold mb-2">Answer:</label>
                <textarea id="faq-answer" name="answer" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3" required></textarea>
            </div>
            <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Add FAQ</button>
        </form>

        <h3 class="text-xl font-semibold mb-4">Existing FAQs</h3>
        <div id="faqs-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            </div>
    </section>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, where } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBVpddOtX1yRxslNxh8yz3SJq53eUYhkZ0",
  authDomain: "next-gen-186aa.firebaseapp.com",
  projectId: "next-gen-186aa",
  storageBucket: "next-gen-186aa.firebasestorage.app",
  messagingSenderId: "338569531164",
  appId: "1:338569531164:web:932df077b59a0a371b34d9",
  measurementId: "G-7GCT5KHFQ0"
};

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Admin UIDs - Replace with your actual UIDs
        const superAdminUID = "PjtAITuXjLYN6A1NX4pzy9KEZwJ3"; // e.g., "someSuperAdminUID123"
        const subAdminUID = "vuY4TfTHdyRmltDUWCQerWGEyEG3";   // e.g., "someSubAdminUID456"

        const loginSection = document.getElementById('login-section');
        const adminContent = document.getElementById('admin-content');
        const loginForm = document.getElementById('login-form');
        const logoutButton = document.getElementById('logout-button');
        const addToolForm = document.getElementById('add-tool-form');
        const toolsList = document.getElementById('tools-list');
        const addFeatureForm = document.getElementById('add-feature-form');
        const featuresList = document.getElementById('features-list');
        const addFaqForm = document.getElementById('add-faq-form');
        const faqsList = document.getElementById('faqs-list');

        // Function to check admin status and display content
        const checkAdminStatus = (user) => {
            console.log("checkAdminStatus called for user:", user ? user.uid : "null");
            if (user && (user.uid === superAdminUID || user.uid === subAdminUID)) {
                console.log("User is an admin. Displaying admin content.");
                loginSection.style.display = 'none';
                adminContent.style.display = 'block';
                fetchAndRenderTools();
                fetchAndRenderFeatures();
                fetchAndRenderFAQs();
            } else {
                console.log("User is NOT an admin or not logged in. Displaying login section.");
                alert("আপনার অ্যাডমিন প্যানেলে প্রবেশের অনুমতি নেই।");
                logoutUser(); // If someone tries to access admin panel without admin UID, log them out
            }
        };

        // Auth state change listener
        onAuthStateChanged(auth, (user) => {
            console.log("onAuthStateChanged fired. User:", user ? user.uid : "null");
            if (user) {
                checkAdminStatus(user);
            } else {
                console.log("User is logged out. Showing login form.");
                loginSection.style.display = 'block';
                adminContent.style.display = 'none';
            }
        });

        // Login Form Submission
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = loginForm['email'].value;
                const password = loginForm['password'].value;
                console.log("Attempting login with email:", email);

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    console.log('Login successful! User UID:', user.uid);
                    // onAuthStateChanged will handle displaying content
                } catch (error) {
                    console.error('Login failed:', error.code, error.message);
                    alert('লগইন ব্যর্থ হয়েছে: ' + error.message);
                }
            });
        }

        // Logout Function
        const logoutUser = async () => {
            try {
                await signOut(auth);
                console.log('User logged out successfully.');
                alert('আপনি সফলভাবে লগআউট করেছেন।');
                // onAuthStateChanged will handle displaying login form
            } catch (error) {
                console.error('Logout failed:', error.message);
                alert('লগআউট ব্যর্থ হয়েছে: ' + error.message);
            }
        };

        if (logoutButton) {
            logoutButton.addEventListener('click', logoutUser);
        }

        // --- CRUD Operations for Tools ---
        const fetchAndRenderTools = async () => {
            console.log("Fetching tools...");
            toolsList.innerHTML = '';
            const querySnapshot = await getDocs(collection(db, "tools"));
            querySnapshot.forEach((doc) => {
                const tool = doc.data();
                const toolId = doc.id;
                const toolCard = `
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col">
                        <img src="${tool.image}" alt="${tool.name}" class="w-full h-32 object-cover mb-4 rounded">
                        <h4 class="text-lg font-semibold">${tool.name}</h4>
                        <p class="text-gray-600 text-sm mb-2 flex-grow">${tool.description}</p>
                        <a href="${tool.link}" target="_blank" class="text-blue-500 hover:underline text-sm mb-2">Visit Tool</a>
                        <div class="mt-auto flex justify-end space-x-2">
                            <button data-id="${toolId}" class="edit-tool-btn bg-yellow-500 hover:bg-yellow-600 text-white text-xs py-1 px-2 rounded">Edit</button>
                            <button data-id="${toolId}" class="delete-tool-btn bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded">Delete</button>
                        </div>
                    </div>
                `;
                toolsList.innerHTML += toolCard;
            });
            attachToolEventListeners();
            console.log("Tools rendered.");
        };

        const attachToolEventListeners = () => {
            document.querySelectorAll('.delete-tool-btn').forEach(button => {
                button.onclick = async (e) => {
                    const toolId = e.target.dataset.id;
                    if (confirm('Are you sure you want to delete this tool?')) {
                        try {
                            await deleteDoc(doc(db, "tools", toolId));
                            alert('Tool deleted successfully!');
                            console.log('Tool deleted:', toolId);
                            fetchAndRenderTools();
                        } catch (error) {
                            console.error('Failed to delete tool:', error.message);
                            alert('Failed to delete tool: ' + error.message);
                        }
                    }
                };
            });

            document.querySelectorAll('.edit-tool-btn').forEach(button => {
                button.onclick = async (e) => {
                    const toolId = e.target.dataset.id;
                    // In a real app, you'd populate a form with existing data for editing
                    alert('Edit functionality for tool ' + toolId + ' is not yet implemented.');
                    // Example: You might open a modal with a form pre-filled with tool data
                };
            });
        };

        if (addToolForm) {
            addToolForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newTool = {
                    name: addToolForm['tool-name'].value,
                    description: addToolForm['tool-description'].value,
                    image: addToolForm['tool-image'].value,
                    link: addToolForm['tool-link'].value,
                    timestamp: new Date() // Add a timestamp for ordering
                };
                try {
                    await addDoc(collection(db, "tools"), newTool);
                    alert('Tool added successfully!');
                    console.log('Tool added:', newTool.name);
                    addToolForm.reset();
                    fetchAndRenderTools();
                } catch (error) {
                    console.error('Failed to add tool:', error.message);
                    alert('Failed to add tool: ' + error.message);
                }
            });
        }

        // --- CRUD Operations for Features ---
        const fetchAndRenderFeatures = async () => {
            console.log("Fetching features...");
            featuresList.innerHTML = '';
            const querySnapshot = await getDocs(collection(db, "features"));
            querySnapshot.forEach((doc) => {
                const feature = doc.data();
                const featureId = doc.id;
                const featureCard = `
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col">
                        <img src="${feature.image}" alt="${feature.name}" class="w-full h-32 object-cover mb-4 rounded">
                        <h4 class="text-lg font-semibold">${feature.name}</h4>
                        <p class="text-gray-600 text-sm mb-2 flex-grow">${feature.description}</p>
                        <div class="mt-auto flex justify-end space-x-2">
                            <button data-id="${featureId}" class="edit-feature-btn bg-yellow-500 hover:bg-yellow-600 text-white text-xs py-1 px-2 rounded">Edit</button>
                            <button data-id="${featureId}" class="delete-feature-btn bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded">Delete</button>
                        </div>
                    </div>
                `;
                featuresList.innerHTML += featureCard;
            });
            attachFeatureEventListeners();
            console.log("Features rendered.");
        };

        const attachFeatureEventListeners = () => {
            document.querySelectorAll('.delete-feature-btn').forEach(button => {
                button.onclick = async (e) => {
                    const featureId = e.target.dataset.id;
                    if (confirm('Are you sure you want to delete this feature?')) {
                        try {
                            await deleteDoc(doc(db, "features", featureId));
                            alert('Feature deleted successfully!');
                            console.log('Feature deleted:', featureId);
                            fetchAndRenderFeatures();
                        } catch (error) {
                            console.error('Failed to delete feature:', error.message);
                            alert('Failed to delete feature: ' + error.message);
                        }
                    }
                };
            });

            document.querySelectorAll('.edit-feature-btn').forEach(button => {
                button.onclick = async (e) => {
                    const featureId = e.target.dataset.id;
                    alert('Edit functionality for feature ' + featureId + ' is not yet implemented.');
                };
            });
        };

        if (addFeatureForm) {
            addFeatureForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newFeature = {
                    name: addFeatureForm['feature-name'].value,
                    description: addFeatureForm['feature-description'].value,
                    image: addFeatureForm['feature-image'].value,
                    timestamp: new Date()
                };
                try {
                    await addDoc(collection(db, "features"), newFeature);
                    alert('Feature added successfully!');
                    console.log('Feature added:', newFeature.name);
                    addFeatureForm.reset();
                    fetchAndRenderFeatures();
                } catch (error) {
                    console.error('Failed to add feature:', error.message);
                    alert('Failed to add feature: ' + error.message);
                }
            });
        }

        // --- CRUD Operations for FAQs ---
        const fetchAndRenderFAQs = async () => {
            console.log("Fetching FAQs...");
            faqsList.innerHTML = '';
            const querySnapshot = await getDocs(collection(db, "faqs"));
            querySnapshot.forEach((doc) => {
                const faq = doc.data();
                const faqId = doc.id;
                const faqCard = `
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                        <h4 class="text-lg font-semibold">${faq.question}</h4>
                        <p class="text-gray-600 text-sm mb-2">${faq.answer}</p>
                        <div class="flex justify-end space-x-2">
                            <button data-id="${faqId}" class="edit-faq-btn bg-yellow-500 hover:bg-yellow-600 text-white text-xs py-1 px-2 rounded">Edit</button>
                            <button data-id="${faqId}" class="delete-faq-btn bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded">Delete</button>
                        </div>
                    </div>
                `;
                faqsList.innerHTML += faqCard;
            });
            attachFaqEventListeners();
            console.log("FAQs rendered.");
        };

        const attachFaqEventListeners = () => {
            document.querySelectorAll('.delete-faq-btn').forEach(button => {
                button.onclick = async (e) => {
                    const faqId = e.target.dataset.id;
                    if (confirm('Are you sure you want to delete this FAQ?')) {
                        try {
                            await deleteDoc(doc(db, "faqs", faqId));
                            alert('FAQ deleted successfully!');
                            console.log('FAQ deleted:', faqId);
                            fetchAndRenderFAQs();
                        } catch (error) {
                            console.error('Failed to delete FAQ:', error.message);
                            alert('Failed to delete FAQ: ' + error.message);
                        }
                    }
                };
            });

            document.querySelectorAll('.edit-faq-btn').forEach(button => {
                button.onclick = async (e) => {
                    const faqId = e.target.dataset.id;
                    alert('Edit functionality for FAQ ' + faqId + ' is not yet implemented.');
                };
            });
        };
    </script>
</body>
</html>
